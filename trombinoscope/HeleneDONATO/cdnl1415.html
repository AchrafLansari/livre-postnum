<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Trombinoscope CDNL 14-15</title>
	    <script type="text/javascript" src="../../public/js/d3.js"></script>
	    <script type="text/javascript" src="../../public/js/queue.v1.min.js" ></script>
		
		<script type="text/javascript">

		var ficSVG = "../../svg/heleneDONATO.svg";
		var ficCSV = "../../data/ProfilsCDNL1415.csv";
		var dataProfil;
		
		var arrIds = [{"idClick":"alexandre", "nom":"Pain", "prenom":"Alexandre", "profil":"Programmeur", "idCSV":12},
		{"idClick":"alexia", "nom":"Camail", "prenom":"Alexia", "profil":"Graphiste", "idCSV":10},
		{"idClick":"antoine", "nom":"Barres", "prenom":"Antoine", "profil":"Graphiste", "idCSV":11},
		{"idClick":"gabriela", "nom":"Paredes", "prenom":"Gabriela", "profil":"Graphiste", "idCSV":13},
		{"idClick":"louis", "nom":"Crolus", "prenom":"Louis", "profil":"Programmeur", "idCSV":3},
		{"idClick":"amin", "nom":"Ghazi", "prenom":"Amin", "profil":"Programmeur", "idCSV":0},
		{"idClick":"clementine", "nom":"Plissonnier", "prenom":"Clémentine", "profil":"Graphiste", "idCSV":2},
		{"idClick":"guillaume", "nom":"", "prenom":"Guillaume", "profil":"Graphiste", "idCSV":5},
		{"idClick":"macaire", "nom":"Del Monaco", "prenom":"Macaire", "profil":"Programmeur", "idCSV":6},
		{"idClick":"helene", "nom":"Donato", "prenom":"Hélène", "profil":"Graphiste","idCSV":4},
		{"idClick":"hugo", "nom":"Stephan", "prenom":"Hugo", "profil":"Programmeur", "idCSV":1},
		{"idClick":"marc", "nom":"Biofa", "prenom":"Marc", "profil":"Programmeur", "idCSV":14},
		{"idClick":"quentin", "nom":"Brunet", "prenom":"Quentin", "profil":"Graphiste", "idCSV":7},
		{"idClick":"simon", "nom":"Tschan", "prenom":"Simon", "profil":"Graphiste", "idCSV":8},
		{"idClick":"yolaine", "nom":"Raymond", "prenom":"Yolaine", "profil":"Graphiste", "idCSV":9}];
		
		function load(){
		 	//charge l'IHM SVG
		    //merci à http://bl.ocks.org/KoGor/8162640
		    	queue()
		    		.defer(d3.xml, ficSVG, "image/svg+xml")
		    		.await(IHMcharge);
					chargeData(ficCSV);
		}

	    function IHMcharge(error, xml){
	    	//Adding our svg file to HTML document
			var importedNode = document.importNode(xml.documentElement, true);
    	  		d3.select("#viz").node().appendChild(importedNode);	    	    	  	
    	  		ajoutelesevenementauxelements();
	    }		
		
		function chargeData(url){
			d3.csv(url, function(error, data) {

				dataProfil = data;
				//affiche les données dans la console
				// Compute the distinct nodes from the links.
				dataProfil.forEach(function(d, i) {
				    console.log(i+" : "+d.nom);
				});				
				
			});
		}
	    
		// fonction pour ajouter un écouteur à UN ÉLÉMENT
		//merci à https://developer.mozilla.org/fr/docs/DOM/element.addEventListener
		function ajoutelesevenementauxelements() { 
		
			for (var i = 0; i < arrIds.length; i++) {
				//length = taille du tableau
			     var el = document.getElementById(arrIds[i].idClick); 
				 var j = i;
			     el.addEventListener("click", afficheDetailEtu,false); 
			    	
			} 		
		}
		/*
		 merci à http://www.commentcamarche.net/forum/affich-21135416-html-afficher-cacher-une-div-sur-clique-a
		 */
		function switchInfoPerso()
		{
			divInfo = document.getElementById('divacacher');
			if (divInfo.style.display == 'none')
				divInfo.style.display = 'block';
			else
				divInfo.style.display = 'none';
		}
		
		function afficheDetailEtu(evt){
		
			//récupère les information de l'étudiant
			var item = getElementArr(arrIds, "idClick", evt.currentTarget.id);
			
			//Récupérer les données du csv
			var itemCSV = dataProfil[item.idCSV];
			
			//change les textes
			var elemTxt = document.getElementById('nom');
			//elemTxt.textContent=item.nom;
			elemTxt.textContent=itemCSV["nom"];
			elemTxt = document.getElementById('prenom');
			//elemTxt.textContent=item.prenom;
			elemTxt.textContent=itemCSV["Prénom"];
			elemTxt = document.getElementById('profil');
			elemTxt.textContent=item.profil;
			//elemTxt.textContent=itemCSV["profil"];
		
			elemTxt = document.getElementById('notegraph_1_');
			elemTxt.textContent=itemCSV["Graphisme"];
			elemTxt = document.getElementById('notecode');
			elemTxt.textContent=itemCSV["Code"];
		}

		function getElementArr(arr, prop, val){
			for (var i = 0; i < arr.length; i++) {
				if(arr[i][prop]==val)return arr[i];
			}
			return false;
		}
		</script>
	</head>
	<body onLoad="load();" bgcolor="#BE1E2D">
		<div id="viz" ></div>
	</body>
</html>

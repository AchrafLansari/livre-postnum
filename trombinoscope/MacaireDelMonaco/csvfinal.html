<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>svg</title>

	    <script type="text/javascript" src="../../public/js/d3.js"></script>
	    <script type="text/javascript" src="../../public/js/queue.v1.min.js" ></script>
		<script type="text/javascript">

		var ficSVG = "../../svg/macaire-svg3.svg";
		var ficCSV = "../../data/ProfilsCDNL1415.csv";

		var dataProfil;
		var itemCSV;
		var arrIds = [
		
			{"idCSV":0,"idClick":"amin","Age":"25","urlTof":"../../data/trombi/CDNL1415/9.jpg"},
			{"idCSV":1,"idClick":"hugo","Age":"22","urlTof":"../../data/trombi/CDNL1415/2.jpg"},
			{"idCSV":2,"idClick":"clementine","Age":"21","urlTof":"../../data/trombi/CDNL1415/7.jpg"},
			{"idCSV":3,"idClick":"louis","Age":"22","urlTof":"../../data/trombi/CDNL1415/15.jpg"},
			{"idCSV":4,"idClick":"helene","Age":"22","urlTof":"../../data/trombi/CDNL1415/13.jpg"},
			{"idCSV":5,"idClick":"guillaume","Age":"22","urlTof":"../../data/trombi/CDNL1415/14.jpg"},
			{"idCSV":6,"idClick":"macaire","Age":"30","urlTof":"../../data/trombi/CDNL1415/5.jpg"},
			{"idCSV":7,"idClick":"quentin","Age":"24","urlTof":"../../data/trombi/CDNL1415/10.jpg"},
			{"idCSV":8,"idClick":"simon","Age":"24","urlTof":"../../data/trombi/CDNL1415/11.jpg"},
			{"idCSV":9,"idClick":"yolaine","Age":"24","urlTof":"../../data/trombi/CDNL1415/8.jpg"},
			{"idCSV":10,"idClick":"alexia","Age":"22","urlTof":"../../data/trombi/CDNL1415/12.jpg"},
			{"idCSV":11,"idClick":"antoine","Age":"25","urlTof":"../../data/trombi/CDNL1415/3.jpg"},
			{"idCSV":12,"idClick":"alexandre","Age":"25","urlTof":"../../data/trombi/CDNL1415/6.jpg"},
			{"idCSV":13,"idClick":"gabriela","Age":"28","urlTof":"../../data/trombi/CDNL1415/4.jpg"},
			{"idCSV":14,"idClick":"marc","Age":"25","urlTof":"../../data/trombi/CDNL1415/17.jpg"},
			
			];

		
		function load(){
		 	//charge l'IHM SVG
		 	//chargeIHM();
		 	queue()
	    		.defer(d3.xml, ficSVG, "image/svg+xml")
	    		.await(IHMcharge);
	    	chargeData(ficCSV);
		}


		function chargeData(url){
			d3.csv(url, function(error, data) {

				dataProfil = data;
				//affiche les données dans la console
				// Compute the distinct nodes from the links.
				dataProfil.forEach(function(d, i) {
				    console.log(i+" : "+d.nom);
				});				
				
			});
		}

	    function IHMcharge(error, xml){
	    	//Adding our svg file to HTML document
			var importedNode = document.importNode(xml.documentElement, true);
    	  	d3.select("#viz").node().appendChild(importedNode);	 
    	  	ajoutelesevenementauxelements();	  	
	    }		
	    
		// fonction pour ajouter un écouteur à UN ÉLÉMENT
		//merci à https://developer.mozilla.org/fr/docs/DOM/element.addEventListener
		function ajoutelesevenementauxelements() { 
		
			for (var i = 0; i < arrIds.length; i++) {
				//length = taille du tableau
			     var el = document.getElementById(arrIds[i].idClick); 
				 var j = i;
			     el.addEventListener("click", afficheDetailEtu,false); 
			    	
			} 		
		}	
		
		/*
		 merci à http://www.commentcamarche.net/forum/affich-21135416-html-afficher-cacher-une-div-sur-clique-a
		 */
		function switchInfoPerso()
		{
			divInfo = document.getElementById('divacacher');
			if (divInfo.style.display == 'none')
				divInfo.style.display = 'block';
			else
				divInfo.style.display = 'none';
		}
		
		function afficheDetailEtu(evt){

			//récupère la balise image grand format
			var elemIma = document.getElementById('Cadre');
			//récupère les information de l'étudiant
			var item = getElementArr(arrIds, "idClick", evt.currentTarget.id);
			//Récupérer les données du csv
			itemCSV = dataProfil[item.idCSV];
			//mettre à jour l'image
			elemIma.setAttribute("xlink:href",item.urlTof);
			//change les textes
			var elemNom = document.getElementById('TxtNom');
			var elemGraphisme = document.getElementById('Graphisme');
			var elemCode = document.getElementById('Code');
			var elemParcours = document.getElementById('Parcours');
			var elemMail = document.getElementById('Mail');
			var elemAge = document.getElementById('Age');
			var elemEnvies = document.getElementById('Envies');
			var elemAmbitions = document.getElementById('ambitions');
			
			
			
			elemAge.textContent=item.Age + " ans";
			elemMail.textContent=itemCSV["Email"];
			elemNom.textContent=itemCSV["Prénom"]+" "+itemCSV["nom"];
			elemGraphisme.textContent="Graphisme : " + itemCSV["Graphisme"];
			elemCode.textContent="Code : " + itemCSV["Code"];
			//elemParcours.textContent="Parcours : " + itemCSV["Parcours"];

			setTxtDiv("Cadre_5", "Parcours");
			setTxtDiv("Cadre_3", "Envies");
			setTxtDiv("Cadre_2", "ambitions");
		}	
			
		function setTxtDiv(idBbox, idDiv){
			
			var txtDiv = document.getElementById("div"+idDiv)
			if(txtDiv){
				txtDiv.innerHTML = itemCSV[idDiv];
			}else{
				var bbCadre = document.getElementById(idBbox).getBBox();			
				d3.select("#Rectangles").append('foreignObject')
	            .attr('x', bbCadre.x)
	            .attr('y', bbCadre.y)
	            .attr('width', bbCadre.width)
	            .attr('height', bbCadre.height)
	            .append("xhtml:body")
				.html('<div id="div'+idDiv+'" >'+itemCSV[idDiv]+'</div>')
			}
			
			
		}


		//http://bl.ocks.org/mbostock/7555321
		//code pour tspan
		
		function getElementArr(arr, prop, val){
			for (var i = 0; i < arr.length; i++) {
				if(arr[i][prop]==val)return arr[i];
			}
			return false;
		}

		

		</script>
		<style type="text/css">
			#ambitions{
			 	width: 490px; color:#fff; font-size:13px; font-family: BonvenoCF-Light; padding-top:40px;
			 }
		</style>
	</head>
	<body onload="load();">
		<div id="viz" ></div>
	</body>
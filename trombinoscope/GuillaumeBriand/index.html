<!doctype html>

<html lang="en">
<head>
	    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	    <title>Trombinoscope CDNL 14-15</title>
	    <script type="text/javascript" src="../../public/js/d3.js"></script>
	    <script type="text/javascript" src="../../public/js/queue.v1.min.js" ></script>
            
	    <script type="text/javascript">
                
		var ficSVG = "../../svg/trombi_guillaume_briand.svg";
                var ficCSV = "../../data/ProfilsCDNL1415.csv";
                
                var arrIds = [   {"idCSV":0,"idClick":"Amin","urlTof":"../../data/trombi/CDNL1415/9.jpg","nom":"Amin","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":1,"idClick":"Hugo","urlTof":"../../data/trombi/CDNL1415/2.jpg","nom":"Hugo","comp":"pas mal aussi"}
                                ,{"idCSV":2,"idClick":"Clem","urlTof":"../../data/trombi/CDNL1415/7.jpg","nom":"Clémentine","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":3,"idClick":"Louis","urlTof":"../../data/trombi/CDNL1415/15.jpg","nom":"Louis","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":4,"idClick":"Helene","urlTof":"../../data/trombi/CDNL1415/13.jpg","nom":"Hélène","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":5,"idClick":"Guillaume","urlTof":"../../data/trombi/CDNL1415/14.jpg","nom":"Guillaume","comp":"pas mal"}
                                ,{"idCSV":6,"idClick":"Macaire","urlTof":"../../data/trombi/CDNL1415/5.jpg","nom":"Macaire","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":7,"idClick":"Quentin","urlTof":"../../data/trombi/CDNL1415/10.jpg","nom":"Quentin","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":8,"idClick":"Simon","urlTof":"../../data/trombi/CDNL1415/11.jpg","nom":"Simon","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":9,"idClick":"Yo","urlTof":"../../data/trombi/CDNL1415/8.jpg","nom":"Yolaine","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":10,"idClick":"Alexia","urlTof":"../../data/trombi/CDNL1415/12.jpg","nom":"Alexia","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":11,"idClick":"Antoine","urlTof":"../../data/trombi/CDNL1415/3.jpg","nom":"Antoine","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":12,"idClick":"Alex","urlTof":"../../data/trombi/CDNL1415/6.jpg","nom":"Alexandre","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":13,"idClick":"Gabi","urlTof":"../../data/trombi/CDNL1415/4.jpg","nom":"Gabriela","comp":"il confond son nom avec son mail..."}
                                ,{"idCSV":14,"idClick":"Marc","urlTof":"../../data/trombi/CDNL1415/17.jpg","nom":"Marc","comp":"pas mal"}	
                                ];
        
                        
                        function load(){
                                //charge l'IHM SVG
                                //chargeIHM();
                                queue()
                                .defer(d3.xml, ficSVG, "image/svg+xml")
                                .await(IHMcharge);
                        chargeData(ficCSV);
                        }
        
        
                        function chargeData(url){
                                d3.csv(url, function(error, data) {
        
                                        dataProfil = data;
                                        //affiche les données dans la console
                                        // Compute the distinct nodes from the links.
                                        dataProfil.forEach(function(d, i) {
                                            console.log(i+" : "+d.nom);
                                        });				
                                        
                                });
                        }
        
                    function IHMcharge(error, xml){
                        //Adding our svg file to HTML document
                                var importedNode = document.importNode(xml.documentElement, true);
                        d3.select("#viz").node().appendChild(importedNode);	 
                        ajoutelesevenementauxelements();	  	
                    }		
                    
                        // fonction pour ajouter un écouteur à UN ÉLÉMENT
                        //merci à https://developer.mozilla.org/fr/docs/DOM/element.addEventListener
                        function ajoutelesevenementauxelements() { 
                        
                                for (var i = 0; i < arrIds.length; i++) {
                                        //length = taille du tableau
                                     var el = document.getElementById(arrIds[i].idClick); 
                                         var j = i;
                                     el.addEventListener("click", afficheDetailEtu,false); 
                                        
                                } 		
                        }	
                        
                        /*
                         merci à http://www.commentcamarche.net/forum/affich-21135416-html-afficher-cacher-une-div-sur-clique-a
                         */
                        function switchInfoPerso()
                        {
                                divInfo = document.getElementById('divacacher');
                                if (divInfo.style.display == 'none')
                                        divInfo.style.display = 'block';
                                else
                                        divInfo.style.display = 'none';
                        }
                        
                        function afficheDetailEtu(evt){
                                
        
                                        d3.select("foreignObject").remove();
        
        
                                //récupère la balise image grand format
                                var elemIma = document.getElementById('Cadre');
                                //récupère les information de l'étudiant
                                var item = getElementArr(arrIds, "idClick", evt.currentTarget.id);
                                //Récupérer les données du csv
                                var itemCSV = dataProfil[item.idCSV];
                                //mettre à jour l'image
                                elemIma.setAttribute("xlink:href",item.urlTof);
                                //change les textes
                                var elemNom = document.getElementById('TxtNom');
                                var elemGraphisme = document.getElementById('Graphisme');
                                var elemCode = document.getElementById('Code');
                                var elemParcours = document.getElementById('Parcours');
        
        
                                elemNom.textContent=itemCSV["Prénom"]+" "+itemCSV["nom"];
                                elemGraphisme.textContent="Graphisme : " + itemCSV["Graphisme"];
                                elemCode.textContent="Code : " + itemCSV["Code"];
                                //elemParcours.textContent="Parcours : " + itemCSV["Parcours"];
        
                                var bbCadre = document.getElementById("Cadre_2").getBBox();
                                
                                d3.select("#Rectangles").append('foreignObject')
                    .attr('x', bbCadre.x)
                    .attr('y', bbCadre.y)
                    .attr('width', bbCadre.width)
                    .attr('height', bbCadre.height)
                    .append("xhtml:body")
                                        .html('<div id="Parcours" style="margin-left : 10px; margin-top : 50px; width: 250px;">'+itemCSV["Parcours"]+'</div>')
        
                        }
        
        
                        //http://bl.ocks.org/mbostock/7555321
                        //code pour tspan
                        
                        function getElementArr(arr, prop, val){
                                for (var i = 0; i < arr.length; i++) {
                                        if(arr[i][prop]==val)return arr[i];
                                }
                                return false;
                        }


    </script>
</head>

<body onload="load();">
    <div id="viz" ></div>
</body>
</html>
